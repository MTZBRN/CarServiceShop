<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="CarServiceShopMAUI.Views.CarListPage"
             Title="AutÃ³k listÃ¡ja"
             Shell.NavBarIsVisible="True">

    <Grid RowDefinitions="Auto,Auto,Auto,*,Auto" 
          Padding="15"
          RowSpacing="10">

        <!-- Header: SzÃ¡mlÃ¡lÃ³ -->
        <Frame Grid.Row="0" 
               BackgroundColor="#2196F3" 
               Padding="15" 
               CornerRadius="10"
               HasShadow="True">
            <Label Text="{Binding FilteredCars.Count, StringFormat='ðŸ“Š TalÃ¡latok: {0} autÃ³'}" 
                   FontSize="20" 
                   FontAttributes="Bold"
                   TextColor="White"
                   HorizontalTextAlignment="Center"/>
        </Frame>

        <!-- KeresÅ‘sÃ¡v -->
        <Frame Grid.Row="1" 
               BackgroundColor="White" 
               Padding="5" 
               CornerRadius="10"
               HasShadow="True"
               BorderColor="#E0E0E0">
            <SearchBar Placeholder="ðŸ” KeresÃ©s: rendszÃ¡m, mÃ¡rka, modell..."
                       Text="{Binding SearchQuery}"
                       BackgroundColor="Transparent"
                       PlaceholderColor="Gray"
                       TextColor="Black"
                       FontSize="16"
                       HeightRequest="50"/>
        </Frame>

        <!-- SzÅ±rÅ‘k -->
        <Frame Grid.Row="2" 
               BackgroundColor="#F5F5F5" 
               Padding="10" 
               CornerRadius="10"
               HasShadow="False">
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">

                <!-- MÃ¡rka szÅ±rÅ‘ -->
                <Frame Grid.Column="0" 
                       BackgroundColor="White" 
                       Padding="10" 
                       CornerRadius="8"
                       HasShadow="False">
                    <VerticalStackLayout Spacing="5">
                        <Label Text="ðŸš— MÃ¡rka" 
                               FontSize="14" 
                               FontAttributes="Bold"
                               TextColor="#555"/>
                        <Picker ItemsSource="{Binding AvailableBrands}"
                                SelectedItem="{Binding SelectedBrand}"
                                Title="Ã–sszes mÃ¡rka"
                                FontSize="14"
                                TextColor="Black"
                                HeightRequest="40"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Ã‰vjÃ¡rat szÅ±rÅ‘ -->
                <Frame Grid.Column="1" 
                       BackgroundColor="White" 
                       Padding="10" 
                       CornerRadius="8"
                       HasShadow="False">
                    <VerticalStackLayout Spacing="5">
                        <Label Text="ðŸ“… Ã‰vjÃ¡rat" 
                               FontSize="14" 
                               FontAttributes="Bold"
                               TextColor="#555"/>
                        <Picker ItemsSource="{Binding AvailableYears}"
                                SelectedItem="{Binding SelectedYear}"
                                Title="Ã–sszes Ã©vjÃ¡rat"
                                FontSize="14"
                                TextColor="Black"
                                HeightRequest="40"/>
                    </VerticalStackLayout>
                </Frame>
            </Grid>
        </Frame>

        <!-- AutÃ³k listÃ¡ja -->
        <RefreshView Grid.Row="3"
                     IsRefreshing="{Binding IsRefreshing}"
                     Command="{Binding LoadCarsCommand}"
                     RefreshColor="#2196F3">

            <ScrollView>
                <CollectionView ItemsSource="{Binding FilteredCars}"
                                SelectionMode="None"
                                VerticalOptions="FillAndExpand">

                    <CollectionView.EmptyView>
                        <VerticalStackLayout HorizontalOptions="Center" 
                                           VerticalOptions="Center"
                                           Padding="20">
                            <Label Text="ðŸš—" 
                                   FontSize="60"
                                   HorizontalTextAlignment="Center"/>
                            <Label Text="Nincs megjelenÃ­thetÅ‘ autÃ³" 
                                   FontSize="18"
                                   TextColor="Gray"
                                   HorizontalTextAlignment="Center"
                                   Margin="0,10,0,0"/>
                        </VerticalStackLayout>
                    </CollectionView.EmptyView>

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <!-- Egy autÃ³ kÃ¡rtya -->
                            <Frame BackgroundColor="White" 
                                   Padding="15" 
                                   Margin="0,5,0,5" 
                                   CornerRadius="12"
                                   HasShadow="True"
                                   BorderColor="#E0E0E0">

                                <Grid RowDefinitions="Auto,Auto,Auto" 
                                      RowSpacing="10">

                                    <!-- FÅ‘ informÃ¡ciÃ³k -->
                                    <VerticalStackLayout Grid.Row="0" Spacing="5">
                                        <Label Text="{Binding LicensePlate}" 
                                               FontSize="22" 
                                               FontAttributes="Bold"
                                               TextColor="#1976D2"/>

                                        <HorizontalStackLayout Spacing="10">
                                            <Label Text="ðŸ­" FontSize="16"/>
                                            <Label Text="{Binding Brand}" 
                                                   FontSize="16"
                                                   TextColor="#424242"/>
                                            <Label Text="|" 
                                                   FontSize="16"
                                                   TextColor="#BDBDBD"/>
                                            <Label Text="{Binding Model}" 
                                                   FontSize="16"
                                                   TextColor="#424242"/>
                                        </HorizontalStackLayout>

                                        <HorizontalStackLayout Spacing="10">
                                            <Label Text="ðŸ“…" FontSize="14"/>
                                            <Label Text="{Binding YearOfManufacture, StringFormat='Ã‰vjÃ¡rat: {0}'}" 
                                                   FontSize="14"
                                                   TextColor="#757575"/>
                                        </HorizontalStackLayout>

                                        <HorizontalStackLayout Spacing="10">
                                            <Label Text="ðŸ”§" FontSize="14"/>
                                            <Label Text="{Binding DateOfTechnicalInspection, StringFormat='MÅ±szaki: {0:yyyy.MM.dd}'}" 
                                                   FontSize="14"
                                                   TextColor="#757575"/>
                                        </HorizontalStackLayout>
                                    </VerticalStackLayout>

                                    <!-- ElvÃ¡lasztÃ³ vonal -->
                                    <BoxView Grid.Row="1" 
                                             HeightRequest="1" 
                                             Color="#E0E0E0"/>

                                    <!-- MÅ±veletek -->
                                    <Grid Grid.Row="2" 
                                          ColumnDefinitions="*,*,*" 
                                          ColumnSpacing="8">

                                        <!-- Szervizek gomb -->
                                        <Button Grid.Column="0"
                                                Text="ðŸ”§ Szervizek"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.NavigateToServicesCommand}"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="#FF9800"
                                                TextColor="White"
                                                FontSize="13"
                                                FontAttributes="Bold"
                                                CornerRadius="8"
                                                HeightRequest="45"/>

                                        <!-- SzerkesztÃ©s gomb -->
                                        <Button Grid.Column="1"
                                                Text="âœï¸ Szerkeszt"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.EditCarCommand}"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="#2196F3"
                                                TextColor="White"
                                                FontSize="13"
                                                FontAttributes="Bold"
                                                CornerRadius="8"
                                                HeightRequest="45"/>

                                        <!-- TÃ¶rlÃ©s gomb -->
                                        <Button Grid.Column="2"
                                                Text="ðŸ—‘ï¸ TÃ¶rlÃ©s"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteCarCommand}"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="#F44336"
                                                TextColor="White"
                                                FontSize="13"
                                                FontAttributes="Bold"
                                                CornerRadius="8"
                                                HeightRequest="45"/>
                                    </Grid>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </ScrollView>
        </RefreshView>

        <!-- AlsÃ³ mÅ±veletek -->
        <Grid Grid.Row="4" 
              ColumnDefinitions="*,Auto" 
              ColumnSpacing="10"
              Margin="0,10,0,0">

            <!-- Ãšj autÃ³ hozzÃ¡adÃ¡sa -->
            <Button Grid.Column="0"
                    Text="âž• ÃšJ AUTÃ“ HOZZÃADÃSA"
                    Command="{Binding AddCarCommand}"
                    BackgroundColor="#4CAF50"
                    TextColor="White"
                    FontSize="16"
                    FontAttributes="Bold"
                    CornerRadius="10"
                    HeightRequest="55"/>

            <!-- SzÅ±rÅ‘k tÃ¶rlÃ©se -->
            <Button Grid.Column="1"
                    Text="ðŸ”„"
                    Command="{Binding ClearFiltersCommand}"
                    BackgroundColor="#757575"
                    TextColor="White"
                    FontSize="20"
                    CornerRadius="10"
                    WidthRequest="55"
                    HeightRequest="55"/>
        </Grid>
    </Grid>
</ContentPage>
